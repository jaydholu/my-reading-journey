{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-header">
        <div class="header-content">
            <h1>Settings</h1>
            <p>Manage your account, profile, and preferences</p>
        </div>
    </div>

    <div class="settings-grid">
        <!-- Sidebar Navigation -->
        <div class="settings-sidebar">
            <nav class="settings-nav">
                <button class="nav-item active" data-section="profile">
                    <i class='bx bx-user-circle'></i>
                    <span>Profile</span>
                </button>
                <button class="nav-item" data-section="personal">
                    <i class='bx bx-id-card'></i>
                    <span>Personal Info</span>
                </button>
                <button class="nav-item" data-section="appearance">
                    <i class='bx bx-palette'></i>
                    <span>Appearance</span>
                </button>
                <button class="nav-item" data-section="security">
                    <i class='bx bx-shield-quarter'></i>
                    <span>Security</span>
                </button>
                <button class="nav-item" data-section="data">
                    <i class='bx bx-data'></i>
                    <span>Data</span>
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="settings-content">

            <!-- PROFILE SECTION -->
            <div class="section active" id="profile">
                <div class="section-header">
                    <div class="section-icon-wrapper">
                        <i class='bx bx-user-circle'></i>
                    </div>
                    <div>
                        <h2>Profile Settings</h2>
                        <p>Update your profile photo and basic information</p>
                    </div>
                </div>

                <form method="POST" enctype="multipart/form-data" class="settings-form">
                    {{ form.hidden_tag() }}

                    <!-- Profile Picture Upload -->
                    <div class="profile-picture-section glass-card">
                        <div class="profile-picture-container">
                            <div class="profile-picture-wrapper">
                                {% if current_user.profile_picture %}
                                <img src="{{ current_user.profile_picture }}" alt="Profile" class="profile-picture"
                                    id="profilePreview">
                                {% else %}
                                <div class="profile-picture-placeholder">
                                    <i class='bx bx-user'></i>
                                </div>
                                {% endif %}
                                <div class="profile-picture-overlay">
                                    <i class='bx bx-camera'></i>
                                </div>
                            </div>
                            <input type="file" id="profilePictureInput" name="profile_picture" accept="image/*"
                                style="display: none;">
                        </div>
                        <div class="profile-picture-info">
                            <h3>Profile Picture</h3>
                            <p>Click on the avatar to upload a new picture. Recommended size: 500x500px</p>
                            <div class="profile-picture-actions">
                                <button type="button" class="btn btn-sm btn-primary"
                                    onclick="document.getElementById('profilePictureInput').click()">
                                    <i class='bx bx-upload'></i>
                                    Upload Photo
                                </button>
                                {% if current_user.profile_picture %}
                                <button type="button" class="btn btn-sm btn-secondary" onclick="removeProfilePicture()">
                                    <i class='bx bx-trash'></i>
                                    Remove
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Basic Information -->
                    <div class="form-card glass-card">
                        <h3 class="form-card-title">
                            <i class='bx bx-info-circle'></i>
                            Basic Information
                        </h3>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class='bx bx-user'></i>
                                    Full Name
                                </label>
                                {{ form.name(class="form-input") }}
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class='bx bx-id-card'></i>
                                    User ID
                                </label>
                                {{ form.userid(class="form-input") }}
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-envelope'></i>
                                    Email Address
                                </label>
                                {{ form.email(class="form-input") }}
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-lg btn-primary">
                            <i class='bx bx-save'></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>

            <!-- PERSONAL INFO SECTION -->
            <div class="section" id="personal">
                <div class="section-header">
                    <div class="section-icon-wrapper">
                        <i class='bx bx-id-card'></i>
                    </div>
                    <div>
                        <h2>Personal Information</h2>
                        <p>Share more about yourself with the community</p>
                    </div>
                </div>

                <form method="POST" class="settings-form">
                    {{ form.hidden_tag() }}

                    <div class="form-card glass-card">
                        <h3 class="form-card-title">
                            <i class='bx bx-user-detail'></i>
                            About You
                        </h3>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class='bx bx-cake'></i>
                                    Birthdate
                                </label>
                                {{ form.birthdate(class="form-input date-input") }}
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class='bx bx-user'></i>
                                    Gender
                                </label>
                                {{ form.gender(class="form-input") }}
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-map'></i>
                                    Country
                                </label>
                                {{ form.country(class="form-input", placeholder="e.g., United States, India, United
                                Kingdom") }}
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-message-detail'></i>
                                    Bio
                                </label>
                                {{ form.bio(class="form-input form-textarea", rows="4", placeholder="Tell us about
                                yourself, your reading interests, favorite genres...") }}
                                <span class="character-count">0 / 500</span>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-game'></i>
                                    Hobbies & Interests
                                </label>
                                {{ form.hobbies(class="form-input", placeholder="Reading, Writing, Traveling,
                                Cooking...") }}
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-book-heart'></i>
                                    Favorite Books
                                </label>
                                {{ form.favorite_books(class="form-input form-textarea", rows="3", placeholder="List
                                your all-time favorite books...") }}
                                <span class="character-count">0 / 500</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-lg btn-primary">
                            <i class='bx bx-save'></i>
                            Save Personal Info
                        </button>
                    </div>
                </form>
            </div>

            <!-- APPEARANCE SECTION -->
            <div class="section" id="appearance">
                <div class="section-header">
                    <div class="section-icon-wrapper">
                        <i class='bx bx-palette'></i>
                    </div>
                    <div>
                        <h2>Appearance</h2>
                        <p>Customize how the app looks for you</p>
                    </div>
                </div>

                <div class="form-card glass-card">
                    <h3 class="form-card-title">
                        <i class='bx bx-moon'></i>
                        Theme Preferences
                    </h3>

                    <div class="theme-selector">
                        <div class="theme-option" data-theme="light">
                            <div class="theme-preview light-preview">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-box"></div>
                                    <div class="preview-box"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <i class='bx bx-sun'></i>
                                <span>Light</span>
                            </div>
                        </div>

                        <div class="theme-option" data-theme="dark">
                            <div class="theme-preview dark-preview">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-box"></div>
                                    <div class="preview-box"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <i class='bx bx-moon'></i>
                                <span>Dark</span>
                            </div>
                        </div>

                        <div class="theme-option" data-theme="auto">
                            <div class="theme-preview auto-preview">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-box"></div>
                                    <div class="preview-box"></div>
                                </div>
                            </div>
                            <div class="theme-info">
                                <i class='bx bx-desktop'></i>
                                <span>Auto</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECURITY SECTION -->
            <div class="section" id="security">
                <div class="section-header">
                    <div class="section-icon-wrapper">
                        <i class='bx bx-shield-quarter'></i>
                    </div>
                    <div>
                        <h2>Security</h2>
                        <p>Keep your account safe and secure</p>
                    </div>
                </div>

                <form method="POST" class="settings-form">
                    {{ form.hidden_tag() }}

                    <div class="form-card glass-card">
                        <h3 class="form-card-title">
                            <i class='bx bx-lock'></i>
                            Change Password
                        </h3>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-key'></i>
                                    New Password
                                </label>
                                {{ form.password(class="form-input", placeholder="Leave blank to keep current password")
                                }}
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class='bx bx-check-shield'></i>
                                    Confirm New Password
                                </label>
                                {{ form.confirm_password(class="form-input", placeholder="Confirm your new password") }}
                            </div>
                        </div>

                        <div class="password-requirements">
                            <h4>Password Requirements:</h4>
                            <ul>
                                <li><i class='bx bx-check-circle'></i> At least 8 characters</li>
                                <li><i class='bx bx-check-circle'></i> One uppercase letter</li>
                                <li><i class='bx bx-check-circle'></i> One lowercase letter</li>
                                <li><i class='bx bx-check-circle'></i> One number</li>
                                <li><i class='bx bx-check-circle'></i> One special character</li>
                            </ul>
                        </div>
                    </div>

                    <div class="form-card glass-card">
                        <h3 class="form-card-title">
                            <i class='bx bx-log-out'></i>
                            Account Actions
                        </h3>

                        <div class="account-action">
                            <div class="action-info">
                                <h4>Logout</h4>
                                <p>Sign out of your account on this device</p>
                            </div>
                            <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">
                                <i class='bx bx-log-out'></i>
                                Logout
                            </a>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-lg btn-primary">
                            <i class='bx bx-save'></i>
                            Update Password
                        </button>
                    </div>
                </form>

                <!-- Danger Zone -->
                <div class="danger-zone glass-card">
                    <div class="danger-header">
                        <i class='bx bx-error-circle'></i>
                        <h3>Danger Zone</h3>
                    </div>
                    <p class="danger-text">
                        Once you delete your account, there is no going back. All your books, ratings, and data will be
                        permanently deleted.
                    </p>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal"
                        data-bs-target="#deleteAccountModal">
                        <i class='bx bx-trash'></i>
                        Delete My Account
                    </button>
                </div>
            </div>

            <!-- DATA SECTION -->
            <div class="section" id="data">
                <div class="section-header">
                    <div class="section-icon-wrapper">
                        <i class='bx bx-data'></i>
                    </div>
                    <div>
                        <h2>Data Management</h2>
                        <p>Export or import your reading data</p>
                    </div>
                </div>

                <div class="form-card glass-card">
                    <h3 class="form-card-title">
                        <i class='bx bx-download'></i>
                        Export Your Data
                    </h3>

                    <div class="data-action">
                        <div class="action-info">
                            <p>Download all your books and reading data in JSON format. You can use this as a backup or
                                to migrate to another device.</p>
                        </div>
                        <a href="{{ url_for('books.download_books') }}" class="btn btn-primary">
                            <i class='bx bx-download'></i>
                            Export Books
                        </a>
                    </div>
                </div>

                <div class="form-card glass-card">
                    <h3 class="form-card-title">
                        <i class='bx bx-upload'></i>
                        Import Your Data
                    </h3>

                    <div class="data-action">
                        <div class="action-info">
                            <p>Upload a JSON file containing your books to import them into your library. This will add
                                new books without removing existing ones.</p>
                        </div>
                        <button class="btn btn-primary" onclick="openUploadModal()">
                            <i class='bx bx-upload'></i>
                            Import Books
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modern-modal">
            <div class="modal-header">
                <div class="modal-title-container">
                    <i class="bx bx-error-circle"></i>
                    <h5 class="modal-title">Delete Account</h5>
                </div>
                <button type="button" class="modal-close" data-bs-dismiss="modal">
                    <i class="bx bx-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <i class='bx bx-error-circle'></i>
                    <h4>This action cannot be undone!</h4>
                </div>
                <p>This will permanently delete your account and remove all of your book data from our servers.</p>
                <p>Please type your User ID <strong>{{ current_user.userid }}</strong> to confirm:</p>
                <form id="deleteAccountForm" method="POST" action="{{ url_for('user.delete_account') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <input type="text" id="confirmUserId" class="form-input" placeholder="Enter your User ID">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="confirmDeleteBtn" class="btn btn-danger" disabled>
                    <i class='bx bx-trash'></i>
                    Delete My Account
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}